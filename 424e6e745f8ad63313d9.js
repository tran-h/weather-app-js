import"./styles.css";import{getIcon}from"./images.js";const KEY="6SSCJH2KBN6AFWSKY27Y844EU",weatherDataDiv=document.querySelector(".weather-data-div"),currentForecastContainer=document.querySelector(".current-forecast-container"),searchBox=document.querySelector("#search-box"),searchBtn=document.querySelector("#search-btn"),convertBtn=document.querySelector("#convert-btn");let currentUnits="F",arrayOfTemps=[];function convertToCelsius(e){return Math.round((e-32)/1.8)}function convertToFahrenheit(e){return Math.round(1.8*e+32)}function updateTempsDisplay(){const e=document.querySelectorAll(".temp-div"),t=document.querySelectorAll(".feels-div"),n=document.querySelectorAll(".high-low-div");for(let r=0;r<e.length;r++)e[r].textContent=`${arrayOfTemps[r].temp} ${currentUnits}`,t[r].textContent=`Feels: ${arrayOfTemps[r].feelslike} ${currentUnits}`,n[r].textContent=`H: ${arrayOfTemps[r].tempmax} ${currentUnits}, L: ${arrayOfTemps[r].tempmin} ${currentUnits}`}async function getWeather(e){const t=`https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/${e}?key=${KEY}`;try{const e=await fetch(t);if(!e.ok)switch(e.status){case 400:throw new Error("BAD_REQUEST – The format of the API is incorrect or an invalid parameter or combination of parameters was supplied");case 401:throw new Error("UNAUTHORIZED – There is a problem with the API key, account or subscription.");case 404:throw new Error("NOT_FOUND – The request cannot be matched to any valid API request endpoint structure.");case 429:throw new Error("TOO_MANY_REQUESTS – The account has exceeded their assigned limits.");case 500:throw new Error("INTERNAL_SERVER_ERROR – A general error has occurred processing the request.")}const n=await e.json();currentForecastContainer.innerHTML="",weatherDataDiv.innerHTML="",convertBtn.className="active";for(let e=0;e<6;e++){const t={temp:n.days[e].temp,feelslike:n.days[e].feelslike,tempmax:n.days[e].tempmax,tempmin:n.days[e].tempmin};arrayOfTemps.push(t)}const r=document.createElement("div");r.classList.add("weather-day-div");const a=document.createElement("div");a.classList.add("date-div"),a.textContent="Today";const s=document.createElement("div");s.classList.add("info-div");const c=document.createElement("img");c.src=getIcon(n.days[0].icon);const o=document.createElement("div");o.classList.add("temp-div"),o.textContent=`${arrayOfTemps[0].temp} ${currentUnits}`;const i=document.createElement("div");i.classList.add("extra-info-div");const m=document.createElement("div");m.textContent=`${n.days[0].conditions}`;const d=document.createElement("div");d.classList.add("feels-div"),d.textContent=`Feels: ${arrayOfTemps[0].feelslike} ${currentUnits}`;const p=document.createElement("div");p.classList.add("high-low-div"),p.textContent=`H: ${arrayOfTemps[0].tempmax} ${currentUnits}, L: ${arrayOfTemps[0].tempmin} ${currentUnits}`,i.append(m),i.append(d),i.append(p),s.append(c),s.append(o),s.append(i),r.append(a),r.append(s),currentForecastContainer.append(r);for(let e=1;e<6;e++){const t=document.createElement("div");t.classList.add("weather-day-div");const r=document.createElement("div");r.classList.add("date-div"),r.textContent=new Date(1e3*n.days[e].datetimeEpoch).toDateString();const a=document.createElement("div");a.classList.add("info-div");const s=document.createElement("img");s.src=getIcon(n.days[e].icon);const c=document.createElement("div");c.classList.add("temp-div"),c.textContent=`${arrayOfTemps[e].temp} ${currentUnits}`;const o=document.createElement("div");o.classList.add("extra-info-div");const i=document.createElement("div");i.textContent=`${n.days[e].conditions}`;const m=document.createElement("div");m.classList.add("feels-div"),m.textContent=`Feels: ${arrayOfTemps[e].feelslike} ${currentUnits}`;const d=document.createElement("div");d.classList.add("high-low-div"),d.textContent=`H: ${arrayOfTemps[e].tempmax} ${currentUnits}, L: ${arrayOfTemps[e].tempmin} ${currentUnits}`,o.append(i),o.append(m),o.append(d),a.append(s),a.append(c),a.append(o),t.append(r),t.append(a),weatherDataDiv.append(t)}convertBtn.onclick=function(){if("F"===currentUnits){let e=[];for(let t=0;t<arrayOfTemps.length;t++){const n={temp:convertToCelsius(arrayOfTemps[t].temp),feelslike:convertToCelsius(arrayOfTemps[t].feelslike),tempmax:convertToCelsius(arrayOfTemps[t].tempmax),tempmin:convertToCelsius(arrayOfTemps[t].tempmin)};e.push(n)}arrayOfTemps=e,currentUnits="C",updateTempsDisplay()}else{let e=[];for(let t=0;t<arrayOfTemps.length;t++){const n={temp:convertToFahrenheit(arrayOfTemps[t].temp),feelslike:convertToFahrenheit(arrayOfTemps[t].feelslike),tempmax:convertToFahrenheit(arrayOfTemps[t].tempmax),tempmin:convertToFahrenheit(arrayOfTemps[t].tempmin)};e.push(n)}arrayOfTemps=e,currentUnits="F",updateTempsDisplay()}}}catch(e){alert(e.message)}}searchBtn.onclick=function(){getWeather(searchBox.value),searchBox.value=""};